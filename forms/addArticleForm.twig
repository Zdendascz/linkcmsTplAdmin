{% macro renderCategoryOptions(categories, path, selectedCategories) %}
    {% import _self as self %}
    {% for category in categories %}
        <option value="{{ category.id }}" {% if category.id in selectedCategories %}selected{% endif %}>
            {{ path }}{{ category.title }}
        </option>
        {% if category.children|length > 0 %}
            {% set newPath = path ~ category.title ~ ' / ' %}
            {{ self.renderCategoryOptions(category.children, newPath, selectedCategories) }}
        {% endif %}
    {% endfor %}
{% endmacro %}

<style>
.category-tag {
    display: inline-flex;
    align-items: center;
    margin-right: 5px;
    background-color: #e9ecef;
    padding: 5px;
    border-radius: 5px;
    margin-top: 5px;
}

.category-tag button {
    margin-left: 5px;
    border: none;
    background-color: #dc3545;
    color: white;
    border-radius: 50%;
    cursor: pointer;
    line-height: 0;
    padding: 0 5px;
}

.ql-editor {
    min-height: 700px; /* Minimální výška */
    max-height: 1500px; /* Maximální výška */
    overflow-y: auto; /* Povolí posouvání, pokud je obsah delší */
}
</style>
<form id="articleForm" method="post" action="{{ domainData.SITE_WEB }}/admin/doArticle">
    <div class="card">
        <div class="card-header">
            <h5 class="card-title">Obsah stránky</h5>
        </div>
        <div class="card-body">
        
            <!-- Skryté ID článku -->
            <input type="hidden" class="form-control" id="id" name="id" value="{{ pageData.article.id|default('') }}" />

            <!-- Skryté ID uživatele -->
            <input type="hidden" class="form-control" id="user_id" name="user_id" value="{{ pageData.article.user_id|default(userData.uid) }}" />

            <!-- Název článku a výběr druhu obsahu -->
            <div class="row mb-3">
                <div class="col-md-8">
                    <label for="title" class="form-label">Název článku</label>
                    <input type="text" class="form-control" id="title" name="title" value="{{ pageData.article.title|default('') }}" required>
                </div>
                <div class="col-md-2">
                    <label for="status" class="form-label">Stav</label>
                    <select class="form-select" id="status" name="status" required>
                        <option value="development" {% if pageData.article.status == 'development' %}selected{% endif %}>V přípravě</option>
                        <option value="active" {% if pageData.article.status == 'active' %}selected{% endif %}>Aktivní</option>
                        <option value="suspend" {% if pageData.article.status == 'suspend' %}selected{% endif %}>Zrušen</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="content_type" class="form-label">Druh obsahu</label>
                    <select class="form-select" id="content_type" name="meta[content_typ]" required>
                        <option value="article" {% if pageData.article.meta.content_typ == 'article' %}selected{% endif %}>Článek</option>
                        <option value="source" {% if pageData.article.meta.content_typ == 'source' %}selected{% endif %}>Zdrojový kód</option>
                    </select>
                </div>
            </div>

            <!-- Tělo článku -->
            <div class="mb-3">
                <label for="body" class="form-label">Tělo článku</label>
                <!-- Kontejner pro Quill Editor -->
                <div id="editor" style="display: none;"></div>
                <!-- Kontejner pro Ace Editor -->
                <div id="codeEditor" style="height: 500px; width: 100%; display: none;"></div>
                <!-- Skryté textarea pro uchování hodnoty z editorů -->
                <textarea class="form-control" id="body" name="body" style="display:;">{{ pageData.article.body }}</textarea>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-header">
            <h5 class="card-title">Podrobnosti</h5>
        </div>
        <div class="card-body">

            <!-- Výběr kategorií -->
            <div class="mb-3">
                <label for="categorySelect" class="form-label">Vyberte kategorie:</label>
                <select class="form-select" id="categorySelect" name="categories[]" multiple>
                    <option value="">Vyberte kategorii...</option>
                    {% import _self as macros %}
                    {{ macros.renderCategoryOptions(pageData.allCats, '', pageData.article.categories|default([])) }}
                </select>
            </div>
            <div id="selectedCategories" class="selected-categories"></div>

            <!-- Url -->
            <div class="mb-3">
                <label for="subtitle" class="form-label">Adresa stránky</label>
                <input type="text" class="form-control" id="subtitle" readonly name="subtitle" value="{{ pageData.article.url|default('') }}">
            </div>

            <!-- Podnázev -->
            <div class="mb-3">
                <label for="subtitle" class="form-label">Podnázev</label>
                <input type="text" class="form-control" id="subtitle" name="subtitle" value="{{ pageData.article.subtitle|default('') }}">
            </div>

            <!-- Snippet -->
            <div class="mb-3">
                <label for="snippet" class="form-label">Snippet</label>
                <textarea class="form-control" id="snippet" name="snippet">{{ pageData.article.snippet|default('') }}</textarea>
            </div>

            <!-- Krátký text -->
            <div class="mb-3">
                <label for="short_text" class="form-label">Krátký text</label>
                <input type="text" class="form-control" id="short_text" name="short_text" value="{{ pageData.article.short_text|default('') }}">
            </div>


            <!-- Meta Title -->
            <div class="mb-3">
                <label for="metaTitle" class="form-label">Meta Title</label>
                <input type="text" class="form-control" id="metaTitle" name="meta[title]" value="{{ pageData.article.meta.title|default('') }}">
            </div>

            <!-- Meta Description -->
            <div class="mb-3">
                <label for="metaDescription" class="form-label">Meta Description</label>
                <textarea class="form-control" id="metaDescription" name="meta[description]">{{ pageData.article.meta.description|default('') }}</textarea>
            </div>

            <!-- Meta Keywords -->
            <div class="mb-3">
                <label for="metaKeywords" class="form-label">Meta Keywords</label>
                <input type="text" class="form-control" id="metaKeywords" name="meta[keywords]" value="{{ pageData.article.meta.keywords|default('') }}">
            </div>

            <button type="submit" class="btn btn-primary">Uložit příspěvek</button>
        </div>
    </div>
</form>