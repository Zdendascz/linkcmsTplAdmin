{% extends 'layout.twig' %}
{% block headLinks %}
<!-- Přidání Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<!-- Přidání Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
{% endblock %}

{% block titulek %}Editor stránky{% endblock %}
{% block nadpis %}Editor stránky{% endblock %}


{% block content %}
<div class="row">
    {% include 'forms/addArticleForm.twig' %}
</div>
{% endblock %}
{% block jsLinks %}
    <!-- Javascripts -->
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/jquery/jquery-3.5.1.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/perfectscroll/perfect-scrollbar.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/pace/pace.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/apexcharts/apexcharts.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/js/main.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/js/custom.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/js/pages/dashboard.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('categorySelect');
    const selectedCategoriesDiv = document.getElementById('selectedCategories');

    // Funkce pro odstranění kategorie
    window.removeCategory = function(categoryId) {
        const categoryTag = document.getElementById('categoryTag' + categoryId);
        if (categoryTag) {
            categoryTag.remove();
        }
    };

    // Inicializace již vybraných kategorií
    const selectedOptions = categorySelect.selectedOptions;
    for (let option of selectedOptions) {
        createCategoryTag(option.value, option.text);
    }

    // Přidání nově vybraných kategorií
    categorySelect.addEventListener('change', function() {
        const categoryId = this.value;
        const categoryText = this.options[this.selectedIndex].text;
        createCategoryTag(categoryId, categoryText);
        this.value = ''; // Resetování výběru
    });

    // Funkce pro vytvoření tagu kategorie
    function createCategoryTag(categoryId, categoryText) {
        if (!document.getElementById('categoryTag' + categoryId)) {
            const categoryTag = document.createElement('span');
            categoryTag.id = 'categoryTag' + categoryId;
            categoryTag.classList.add('category-tag');
            categoryTag.innerHTML = categoryText + ' <button type="button" onclick="removeCategory(' + categoryId + ')">&times;</button>';

            selectedCategoriesDiv.appendChild(categoryTag);

            // Přidání skrytého inputu
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'categories[]';
            input.value = categoryId;
            categoryTag.appendChild(input);
        }
    }
});

document.addEventListener('DOMContentLoaded', function() {
    // Předpokládáme, že máme pole vybraných kategorií v JavaScriptu,
    // například získané z PHP proměnné 'pageData.article.categories'
    // Toto pole bude muset být převedeno do JavaScriptu, například pomocí inline scriptu nebo jiné metody.
    const selectedCategories = {{ pageData.article.categories|json_encode|raw }};
    // Funkce pro přidání tagu kategorie
    const addCategoryTag = (categoryId, categoryText) => {
        if (!document.getElementById('categoryTag' + categoryId)) {
            const categoryTag = document.createElement('span');
            categoryTag.id = 'categoryTag' + categoryId;
            categoryTag.classList.add('category-tag');
            categoryTag.innerHTML = categoryText + ' <button type="button" onclick="removeCategory(' + categoryId + ')">&times;</button>';

            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'categories[]';
            input.value = categoryId;
            categoryTag.appendChild(input);
            document.getElementById('selectedCategories').appendChild(categoryTag);
        }
    };

    // Projdeme pole vybraných kategorií a pro každou vytvoříme tag
    selectedCategories.forEach(category => {
        addCategoryTag(category.id, category.name);
    });

    // Zde může pokračovat zbytek vašeho stávajícího kódu pro zpracování výběru nových kategorií...
});

document.addEventListener('DOMContentLoaded', function() {
    var toolbarOptions = [
        ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
        ['blockquote','image'],

        
        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
        [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent
        [{ 'direction': 'rtl' }],                         // text direction
        
        [{ 'header': [2, 3, 4, 5, 6, false] }],

        [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
        [{ 'font': [] }],
        [{ 'align': [] }],

        ['clean'],                                        // remove formatting button
        ['code-block']                                    // Příklad přidání tlačítka pro blok kódu
    ];
    
    var quill = new Quill('#editor', {
        debug: 'info',
        theme: 'snow', // nebo 'bubble'
        modules: {
            toolbar: toolbarOptions
        },
        history: {
            delay: 2000,
            maxStack: 500,
            userOnly: false
        },
        imageUploader: {
            upload: file => {
                // Zde musíte implementovat logiku nahrávání obrázků
                // Následující kód je pouze ilustrativní
                return new Promise((resolve, reject) => {
                const formData = new FormData();
                formData.append('image', file);

                fetch('/path-to-your-image-upload-endpoint', {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(result => {
                    resolve(result.path); // URL nahraného obrázku
                })
                .catch(error => {
                    reject("Upload failed");
                });
                });
            }
        }
    });

    quill.on('text-change', function() {
        // Aktualizace skrytého textarea s hodnotou z Quill editoru
        document.querySelector('#body').value = quill.root.innerHTML;
    });

    // Nastavení obsahu Quill editoru na základě skrytého textarea (pokud je editace článku)
    var bodyContent = document.querySelector('#body').value;
    if(bodyContent) {
        quill.root.innerHTML = bodyContent;
    }
});

</script>
{% endblock %}