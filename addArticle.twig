{% extends 'layout.twig' %}
{% block headLinks %}
<!-- Přidání Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<!-- Přidání Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<!-- Ace Editor -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
{% endblock %}

{% block titulek %}Editor stránky{% endblock %}
{% block nadpis %}Editor stránky{% endblock %}


{% block content %}
<div class="row">
    {% include 'forms/addArticleForm.twig' %}
</div>
{% endblock %}
{% block jsLinks %}
    <!-- Javascripts -->
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/jquery/jquery-3.5.1.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/perfectscroll/perfect-scrollbar.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/pace/pace.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/plugins/apexcharts/apexcharts.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/js/main.min.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/js/custom.js"></script>
    <script src="{{ domainData.SITE_WEB }}/{{ templateDir}}assets/js/pages/dashboard.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('categorySelect');
    const selectedCategoriesDiv = document.getElementById('selectedCategories');

    // Funkce pro odstranění kategorie
    window.removeCategory = function(categoryId) {
        const categoryTag = document.getElementById('categoryTag' + categoryId);
        if (categoryTag) {
            categoryTag.remove();
        }
    };

    // Inicializace již vybraných kategorií
    const selectedOptions = categorySelect.selectedOptions;
    for (let option of selectedOptions) {
        createCategoryTag(option.value, option.text);
    }

    // Přidání nově vybraných kategorií
    categorySelect.addEventListener('change', function() {
        const categoryId = this.value;
        const categoryText = this.options[this.selectedIndex].text;
        createCategoryTag(categoryId, categoryText);
        this.value = ''; // Resetování výběru
    });

    // Funkce pro vytvoření tagu kategorie
    function createCategoryTag(categoryId, categoryText) {
        if (!document.getElementById('categoryTag' + categoryId)) {
            const categoryTag = document.createElement('span');
            categoryTag.id = 'categoryTag' + categoryId;
            categoryTag.classList.add('category-tag');
            categoryTag.innerHTML = categoryText + ' <button type="button" onclick="removeCategory(' + categoryId + ')">&times;</button>';

            selectedCategoriesDiv.appendChild(categoryTag);

            // Přidání skrytého inputu
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'categories[]';
            input.value = categoryId;
            categoryTag.appendChild(input);
        }
    }
});

document.addEventListener('DOMContentLoaded', function() {
    // Předpokládáme, že máme pole vybraných kategorií v JavaScriptu,
    // například získané z PHP proměnné 'pageData.article.categories'
    // Toto pole bude muset být převedeno do JavaScriptu, například pomocí inline scriptu nebo jiné metody.
    const selectedCategories = {{ pageData.article.categories|json_encode|raw }};
    // Funkce pro přidání tagu kategorie
    const addCategoryTag = (categoryId, categoryText) => {
        if (!document.getElementById('categoryTag' + categoryId)) {
            const categoryTag = document.createElement('span');
            categoryTag.id = 'categoryTag' + categoryId;
            categoryTag.classList.add('category-tag');
            categoryTag.innerHTML = categoryText + ' <button type="button" onclick="removeCategory(' + categoryId + ')">&times;</button>';

            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'categories[]';
            input.value = categoryId;
            categoryTag.appendChild(input);
            document.getElementById('selectedCategories').appendChild(categoryTag);
        }
    };

    // Projdeme pole vybraných kategorií a pro každou vytvoříme tag
    selectedCategories.forEach(category => {
        addCategoryTag(category.id, category.name);
    });

    // Zde může pokračovat zbytek vašeho stávajícího kódu pro zpracování výběru nových kategorií...
});

document.addEventListener('DOMContentLoaded', function() {
    var quill = new Quill('#editor', {
        theme: 'snow'
    });

    var aceEditor = ace.edit("codeEditor");
    aceEditor.setTheme("ace/theme/monokai");
    aceEditor.session.setMode("ace/mode/javascript");

    const contentTypeSelect = document.getElementById('content_type');
    const quillEditorContainer = document.getElementById('editor');
    const codeEditorContainer = document.getElementById('codeEditor');
    const bodyTextArea = document.getElementById('body');

    // Aktualizace obsahu textarea podle aktuálního editoru
    function updateTextarea() {
        if (contentTypeSelect.value === 'article') {
            bodyTextArea.value = quill.root.innerHTML;
        } else {
            bodyTextArea.value = aceEditor.getValue();
        }
    }

    // Listener pro změny v Quill editoru
    quill.on('text-change', function() {
        if (contentTypeSelect.value === 'article') {
            updateTextarea();
        }
    });

    // Listener pro změny v Ace editoru
    aceEditor.getSession().on('change', function() {
        if (contentTypeSelect.value === 'source') {
            updateTextarea();
        }
    });

    // Funkce pro přepínání editorů a aktualizaci obsahu
    function updateEditor() {
        if (contentTypeSelect.value === 'article') {
            quillEditorContainer.style.display = 'block';
            codeEditorContainer.style.display = 'none';
            quill.root.innerHTML = bodyTextArea.value;
        } else {
            quillEditorContainer.style.display = 'none';
            codeEditorContainer.style.display = 'block';
            aceEditor.setValue(bodyTextArea.value);
        }
        updateTextarea(); // Aktualizace obsahu textarea při změně
    }

    // Listener pro výběr typu obsahu
    contentTypeSelect.addEventListener('change', updateEditor);

    // Inicializace editorů při načtení stránky
    updateEditor();
});



</script>
{% endblock %}